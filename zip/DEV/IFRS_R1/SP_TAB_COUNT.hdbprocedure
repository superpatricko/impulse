PROCEDURE "NDB_COMMON"."IFRS_R1::SP_TAB_COUNT"
(IN JOBNAME NVARCHAR(1000)
,OUT TAB_COUNT1 "NDB_COMMON"."IFRS_R1.COMMON_COMP.NDB_COMMON::TABLE_COUNT")
	LANGUAGE SQLSCRIPT
	SQL SECURITY INVOKER 
	--DEFAULT SCHEMA <default_schema_name>
	--READS SQL DATA 
	AS
BEGIN

DECLARE LV_COUNT		INTEGER := 0;
DECLARE LV_VAR 			NVARCHAR(500);
DECLARE SQL_QUERY 			NVARCHAR(500);

DECLARE CURSOR CUR_1 FOR
SELECT TABLE_NAME FROM "_SYS_BIC"."BC_EY89128/SOURCE_MAP_TABLE"
(PLACEHOLDER."$$JOBNAME$$" => :JOBNAME);

CREATE LOCAL TEMPORARY TABLE #TEMP_TABLE (ID1 INTEGER, REC_COUNT NVARCHAR(500));
CREATE LOCAL TEMPORARY TABLE #TEMP_TABLE1 (TABLE_NAME NVARCHAR(500), REC_COUNT NVARCHAR(500));


FOR REC as CUR_1 DO

LV_COUNT := LV_COUNT + 1;

SQL_QUERY := 'INSERT INTO   #TEMP_TABLE '
			 || ' VALUES (' ||LV_COUNT
			 ||',(SELECT COUNT(*) FROM '||REC.TABLE_NAME ||')'||')';
			 	
--select SQL_QUERY		 	  
EXECUTE IMMEDIATE SQL_QUERY;

INSERT INTO #TEMP_TABLE1 VALUES(REC.TABLE_NAME , 
(SELECT REC_COUNT FROM #TEMP_TABLE WHERE ID1 = LV_COUNT)
);

END FOR;  

TAB_COUNT1 = SELECT * FROM #TEMP_TABLE1;
DROP TABLE #TEMP_TABLE;
DROP TABLE #TEMP_TABLE1;
END;
