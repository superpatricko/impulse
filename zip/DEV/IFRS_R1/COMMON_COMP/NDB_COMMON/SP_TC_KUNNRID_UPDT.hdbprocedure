PROCEDURE "NDB_COMMON"."IFRS_R1.COMMON_COMP.NDB_COMMON::SP_TC_KUNNRID_UPDT" ( ) 
	LANGUAGE SQLSCRIPT
	SQL SECURITY INVOKER 
	--DEFAULT SCHEMA <default_schema_name>
	--READS SQL DATA 
	AS
	V_CURR_DATE 		DATE 			:= CURRENT_DATE;  
	V_PROC_ID 	   		INTEGER			:= 30010;
	V_PROC_NAME 		NVARCHAR(30)	:= 'SP_TC_KUNNRID_UPDT';
BEGIN

 	BEGIN -- start of NDB_TS Update
	 
	 		DECLARE EXIT HANDLER FOR SQLEXCEPTION 
	
			BEGIN AUTONOMOUS TRANSACTION  -- Start of exception handler
			
				INSERT INTO "NDB_COMMON"."IFRS_R1.COMMON_COMP.NDB_COMMON::TC_ERROR_LOG"
				(
				 "PROCEDURE_ID","PROCEDURE_NAME", "ERROR_CODE", "ERROR_MESSAGE", "START_END_TIME"
				)
				VALUES
				(
				V_PROC_ID,
				V_PROC_NAME,
				::SQL_ERROR_CODE,
				'While Updating NDB Commission Table '||::SQL_ERROR_MESSAGE,
				V_CURR_DATE
				);
				
				COMMIT;
				RESIGNAL;
			END;  
	 
				UPDATE  "NDB_COMMON"."IFRS_R1.COMMON_COMP.NDB_COMMON::NDB_COMM" NC 
				SET NC.KUNNR = 
				(SELECT NCC.KUNNR_SID FROM 
				"NDB_COMMON"."IFRS_R1.COMMON_COMP.NDB_COMMON::NDB_COMM_CUST" NCC
				WHERE IFNULL(NCC.COMMISSION_TYPE,'X') = IFNULL(NC.COMMISSION_TYPE, 'X')
				AND IFNULL(NCC.PRE_POST_TYPE, 'X') = IFNULL(NC.PRE_POST_TYPE, 'X')
				AND IFNULL(NCC.BRAND, 'X') = IFNULL(NC.BRAND, 'X')
				AND IFNULL(NCC.CHANNEL_CODE, 'X') = IFNULL(NC.CHANNEL_CODE, 'X')
				AND IFNULL(NCC.SEGMENT, 'X') = IFNULL(NC.SEGMENT, 'X')
				AND NC.KUNNR IS NULL AND NCC.KUNNR_SID IS NOT NULL
				GROUP BY 
				NCC.COMMISSION_TYPE, 
				NCC.PRE_POST_TYPE, NCC.BRAND, 
				NCC.CHANNEL_CODE, 
				NCC.SEGMENT,NCC.KUNNR_SID);
			COMMIT;
	
	END; 

  
END;
