PROCEDURE "NDB_MOBILITY"."IFRS_R1.MOBILITY.NDB_MOBILITY::SP_SUSPENDED_CUSTOMERS" ( 
	IN BAN NVARCHAR(9),
	IN SUBSCR_NO NVARCHAR(30),
	IN SUBSCR_ST NVARCHAR(1),
	IN ACTV_CD NVARCHAR(3),
	IN ACTV_RSN_CD NVARCHAR(5),
	IN CONT_TREAT_CODE NVARCHAR(10),
	IN CUSTOMER_EFF_DT DATE) 
	LANGUAGE SQLSCRIPT
	SQL SECURITY INVOKER 
	--DEFAULT SCHEMA <default_schema_name>
	--READS SQL DATA 
	AS  
BEGIN		
	DECLARE RECORD_COUNT 	INTEGER;	
	DECLARE LV_CUR_UTC 		TIMESTAMP := CURRENT_TIMESTAMP;
--------------------------------------------------------------------------------------------------
-- Local Temporary Tables Declaration
--------------------------------------------------------------------------------------------------  

	CREATE LOCAL TEMPORARY TABLE #UPDATE_MOBL_POST_ORDER
	("BAN" NVARCHAR(9) NOT NULL ,
	 "CONTR_TRANS_DT" DATE CS_DAYDATE NOT NULL ,
	 "ITEM_ID" NVARCHAR(20) NOT NULL ,
	 "ITEM_TRANS_DT" DATE CS_DAYDATE NOT NULL ,
	 "SUBSCR_NO" NVARCHAR(30) NOT NULL ,
	 "TRX_SEQ_NO" INTEGER CS_INT NOT NULL ,
	 "BSE_SOC_AMT" DECIMAL(14,4) CS_FIXED,
	 "MIN_TIER_PRC" DECIMAL(13,2) CS_FIXED,
	 "STNDLN_SELL_PRC" DECIMAL(23,2) CS_FIXED,
	 "TRANS_PRC" DECIMAL(23,2) CS_FIXED,
	 "ACTV_CD" NVARCHAR(3) NOT NULL ,
	 "ACTV_RSN_CD" NVARCHAR(5),
	 "BASE_OPT_SERV_IND" NVARCHAR(4),
	 "BSE_SOC" NVARCHAR(9),
	 "BYRS_RMRSE" NVARCHAR(30),
	 "CHRG_TY_CLASSIF" NVARCHAR(100),
	 "CONTR_DEALER_CODE" NVARCHAR(14),
	 "CONTR_END_DT" DATE CS_DAYDATE,
	 "CONTR_ID" NVARCHAR(60) NOT NULL ,
	 "CONTR_STRT_DT" DATE CS_DAYDATE,
	 "CONTR_TERM" DECIMAL(9,2) CS_FIXED,
	 "CONTR_TIER" NVARCHAR(10),
	 "CONTR_TY" NVARCHAR(1),
	 "COST_CENTRE" NVARCHAR(10),
	 "DLR_CD" NVARCHAR(14),
	 "EI_GRP_SEQ_NO" NVARCHAR(30),
	 "EQP_SRC" NVARCHAR(2),
	 "EQP_TY" NVARCHAR(1),
	 "GL_ACCOUNT" NVARCHAR(10) NOT NULL ,
	 "GL_TAX_CD" NVARCHAR(2),
	 "ITEM_END_DT" DATE CS_DAYDATE,
	 "ITEM_GRP_CD" NVARCHAR(9),
	 "ITEM_STRT_DT" DATE CS_DAYDATE,
	 "ITEM_SUB_ID" NVARCHAR(6) NOT NULL ,
	 "JURISD_CD" NVARCHAR(4),
	 "POB_END_DT" DATE CS_DAYDATE NOT NULL ,
	 "PROMO_CD" NVARCHAR(9),
	 "PROV_AGR" NVARCHAR(2),
	 "PROV_CUST" NVARCHAR(2),
	 "SERV_TIER" NVARCHAR(10),
	 "SOC_LEV_CD" NVARCHAR(1),
	 "SUBS_AMT" DECIMAL(13,2) CS_FIXED,
	 "SUBS_EFF_DT" DATE CS_DAYDATE,
	 "SUBS_EXP_DT" DATE CS_DAYDATE,
	 "TERM_M2M" NVARCHAR(4) NOT NULL ,
	 "REV_CD" NVARCHAR(3),
	 "BRND" NVARCHAR(1),
	 "KUNNR_SID" NVARCHAR(10),
	 "GL_PRICE_PLAN_GRP" NVARCHAR(3),
	 "ORIG_CONTR_STRT_DT" DATE CS_DAYDATE,
	 "ORIG_CONTR_TERM" INTEGER CS_INT,
	 "ORIG_STNDLN_SELL_PRC" DECIMAL(23,2) CS_FIXED,
	 "ORIG_TRANS_PRC" DECIMAL(23,2) CS_FIXED,
	 "VIR_INV_TS" LONGDATE CS_LONGDATE,
	 "DIST_CHANNEL" NVARCHAR(2),
	 "PRODUCT_TYPE" NVARCHAR(3),
	 "CUSTOMER_GROUP" NVARCHAR(2),
	 "MATERIAL_GROUP" NVARCHAR(9),
	 "REV_ACTG_DOC_NUM" NVARCHAR(10),
	 "BANNER" NVARCHAR(35),
	 "DEALER" NVARCHAR(40),
	 "REV_ACT_DOC_TY" NVARCHAR(2),
	 "ART_NUM" NVARCHAR(18),
	 "REFERENCE_ID" NVARCHAR(30),
	 "HEADER_ID" NVARCHAR(20),
	 "SRCDOC_ID" NVARCHAR(35),
	 "SRCDOC_ID_TERM" NVARCHAR(35),
	 "MOD_IND" NVARCHAR(4),
	 "TIME_IND" NVARCHAR(4),
	 "BILL_DATE" DATE CS_DAYDATE,
	 "RAI_ITEM_ID" NVARCHAR(15),
	 "RUN_ID" INTEGER CS_INT,
	 "PMP_TS" LONGDATE CS_LONGDATE,
	 "EXECUTION_ID" NVARCHAR(10),
	 "CONVERSION_IND" NVARCHAR(1),
	 "INSERT_TS" LONGDATE CS_LONGDATE,
	 "MODIFIED_TS" LONGDATE CS_LONGDATE,
	 "BATCH_ID" INTEGER CS_INT,
	 "RAI_TS" LONGDATE CS_LONGDATE,
	 "SUBSCR_ST" NVARCHAR(1),
	 "CONT_TREAT_CODE" NVARCHAR(10));
	 
	 
	 INSERT INTO #UPDATE_MOBL_POST_ORDER
	 	("BAN",
		 "CONTR_TRANS_DT",
		 "ITEM_ID",
		 "ITEM_TRANS_DT",
		 "SUBSCR_NO",
		 "TRX_SEQ_NO",
		 "BSE_SOC_AMT",
		 "MIN_TIER_PRC",
		 "STNDLN_SELL_PRC",
		 "TRANS_PRC",
		 "ACTV_CD",
		 "ACTV_RSN_CD",
		 "BASE_OPT_SERV_IND",
		 "BSE_SOC",
		 "BYRS_RMRSE",
		 "CHRG_TY_CLASSIF",
		 "CONTR_DEALER_CODE",
		 "CONTR_END_DT",
		 "CONTR_ID",
		 "CONTR_STRT_DT",
		 "CONTR_TERM",
		 "CONTR_TIER",
		 "CONTR_TY",
		 "COST_CENTRE",
		 "DLR_CD",
		 "EI_GRP_SEQ_NO",
		 "EQP_SRC",
		 "EQP_TY",
		 "GL_ACCOUNT",
		 "GL_TAX_CD",
		 "ITEM_END_DT",
		 "ITEM_GRP_CD",
		 "ITEM_STRT_DT",
		 "ITEM_SUB_ID",
		 "JURISD_CD",
		 "POB_END_DT",
		 "PROMO_CD",
		 "PROV_AGR",
		 "PROV_CUST",
		 "SERV_TIER",
		 "SOC_LEV_CD",
		 "SUBS_AMT",
		 "SUBS_EFF_DT",
		 "SUBS_EXP_DT",
		 "TERM_M2M",
		 "REV_CD",
		 "BRND",
		 "KUNNR_SID",
		 "GL_PRICE_PLAN_GRP",
		 "ORIG_CONTR_STRT_DT",
		 "ORIG_CONTR_TERM",
		 "ORIG_STNDLN_SELL_PRC",
		 "ORIG_TRANS_PRC",
		 "VIR_INV_TS",
		 "DIST_CHANNEL",
		 "PRODUCT_TYPE",
		 "CUSTOMER_GROUP",
		 "MATERIAL_GROUP",
		 "REV_ACTG_DOC_NUM",
		 "BANNER",
		 "DEALER",
		 "REV_ACT_DOC_TY",
		 "ART_NUM",
		 "REFERENCE_ID",
		 "HEADER_ID",
		 "SRCDOC_ID",
		 "SRCDOC_ID_TERM",
		 "MOD_IND",
		 "TIME_IND",
		 "BILL_DATE",
		 "RAI_ITEM_ID",
		 "RUN_ID",
		 "PMP_TS",
		 "EXECUTION_ID",
		 "CONVERSION_IND",
		 "INSERT_TS",
		 "MODIFIED_TS",
		 "BATCH_ID",
		 "RAI_TS",
		 "SUBSCR_ST",
		 "CONT_TREAT_CODE")
		 
	 	select "BAN",
		 "CONTR_TRANS_DT",
		 "ITEM_ID",
		 "ITEM_TRANS_DT",
		 "SUBSCR_NO",
		 "TRX_SEQ_NO",
		 "BSE_SOC_AMT",
		 "MIN_TIER_PRC",
		 "STNDLN_SELL_PRC",
		 "TRANS_PRC",
		 "ACTV_CD",
		 "ACTV_RSN_CD",
		 "BASE_OPT_SERV_IND",
		 "BSE_SOC",
		 "BYRS_RMRSE",
		 "CHRG_TY_CLASSIF",
		 "CONTR_DEALER_CODE",
		 "CONTR_END_DT",
		 "CONTR_ID",
		 "CONTR_STRT_DT",
		 "CONTR_TERM",
		 "CONTR_TIER",
		 "CONTR_TY",
		 "COST_CENTRE",
		 "DLR_CD",
		 "EI_GRP_SEQ_NO",
		 "EQP_SRC",
		 "EQP_TY",
		 "GL_ACCOUNT",
		 "GL_TAX_CD",
		 "ITEM_END_DT",
		 "ITEM_GRP_CD",
		 "ITEM_STRT_DT",
		 "ITEM_SUB_ID",
		 "JURISD_CD",
		 "POB_END_DT",
		 "PROMO_CD",
		 "PROV_AGR",
		 "PROV_CUST",
		 "SERV_TIER",
		 "SOC_LEV_CD",
		 "SUBS_AMT",
		 "SUBS_EFF_DT",
		 "SUBS_EXP_DT",
		 "TERM_M2M",
		 "REV_CD",
		 "BRND",
		 "KUNNR_SID",
		 "GL_PRICE_PLAN_GRP",
		 "ORIG_CONTR_STRT_DT",
		 "ORIG_CONTR_TERM",
		 "ORIG_STNDLN_SELL_PRC",
		 "ORIG_TRANS_PRC",
		 "VIR_INV_TS",
		 "DIST_CHANNEL",
		 "PRODUCT_TYPE",
		 "CUSTOMER_GROUP",
		 "MATERIAL_GROUP",
		 "REV_ACTG_DOC_NUM",
		 "BANNER",
		 "DEALER",
		 "REV_ACT_DOC_TY",
		 "ART_NUM",
		 "REFERENCE_ID",
		 "HEADER_ID",
		 "SRCDOC_ID",
		 "SRCDOC_ID_TERM",
		 "MOD_IND",
		 "TIME_IND",
		 "BILL_DATE",
		 "RAI_ITEM_ID",
		 "RUN_ID",
		 "PMP_TS",
		 "EXECUTION_ID",
		 "CONVERSION_IND",
		 "INSERT_TS",
		 "MODIFIED_TS",
		 "BATCH_ID",
		 "RAI_TS",
		 "SUBSCR_ST",
		 "CONT_TREAT_CODE"
		 from "NDB_MOBILITY"."IFRS_R1.MOBILITY.NDB_MOBILITY::MOBL_POST_ORDER" where 
		 BAN = :BAN and SUBSCR_NO = :SUBSCR_NO
		 and POB_END_DT = '99991231';
	 	 
	 	 
	 	 select count(*) into RECORD_COUNT from #UPDATE_MOBL_POST_ORDER;
	 	 if RECORD_COUNT > 0 then
		 	-------------------------------------------------------------------------<
		 	----------------------------------------------------------------------------
		 	update "NDB_MOBILITY"."IFRS_R1.MOBILITY.NDB_MOBILITY::MOBL_POST_ORDER" o
		 	set o.POB_END_DT = ADD_DAYS(:CUSTOMER_EFF_DT,-1),
		 	o.MODIFIED_TS = :LV_CUR_UTC
			where 
			o.BAN = :BAN and o.SUBSCR_NO = :SUBSCR_NO
			and o.POB_END_DT = '99991231';
		 	
	 	 	INSERT INTO "NDB_MOBILITY"."IFRS_R1.MOBILITY.NDB_MOBILITY::MOBL_POST_ORDER"
		 	("BAN",
			 "CONTR_TRANS_DT",
			 "ITEM_ID",
			 "ITEM_TRANS_DT",
			 "SUBSCR_NO",
			 "TRX_SEQ_NO",
			 "BSE_SOC_AMT",
			 "MIN_TIER_PRC",
			 "STNDLN_SELL_PRC",
			 "TRANS_PRC",
			 "ACTV_CD",
			 "ACTV_RSN_CD",
			 "BASE_OPT_SERV_IND",
			 "BSE_SOC",
			 "BYRS_RMRSE",
			 "CHRG_TY_CLASSIF",
			 "CONTR_DEALER_CODE",
			 "CONTR_END_DT",
			 "CONTR_ID",
			 "CONTR_STRT_DT",
			 "CONTR_TERM",
			 "CONTR_TIER",
			 "CONTR_TY",
			 "COST_CENTRE",
			 "DLR_CD",
			 "EI_GRP_SEQ_NO",
			 "EQP_SRC",
			 "EQP_TY",
			 "GL_ACCOUNT",
			 "GL_TAX_CD",
			 "ITEM_END_DT",
			 "ITEM_GRP_CD",
			 "ITEM_STRT_DT",
			 "ITEM_SUB_ID",
			 "JURISD_CD",
			 "POB_END_DT",
			 "PROMO_CD",
			 "PROV_AGR",
			 "PROV_CUST",
			 "SERV_TIER",
			 "SOC_LEV_CD",
			 "SUBS_AMT",
			 "SUBS_EFF_DT",
			 "SUBS_EXP_DT",
			 "TERM_M2M",
			 "REV_CD",
			 "BRND",
			 "KUNNR_SID",
			 "GL_PRICE_PLAN_GRP",
			 "ORIG_CONTR_STRT_DT",
			 "ORIG_CONTR_TERM",
			 "ORIG_STNDLN_SELL_PRC",
			 "ORIG_TRANS_PRC",
			 "VIR_INV_TS",
			 "DIST_CHANNEL",
			 "PRODUCT_TYPE",
			 "CUSTOMER_GROUP",
			 "MATERIAL_GROUP",
			 "REV_ACTG_DOC_NUM",
			 "BANNER",
			 "DEALER",
			 "REV_ACT_DOC_TY",
			 "ART_NUM",
			 "REFERENCE_ID",
			 "HEADER_ID",
			 "SRCDOC_ID",
			 "SRCDOC_ID_TERM",
			 "MOD_IND",
			 "TIME_IND",
			 "BILL_DATE",
			 "RAI_ITEM_ID",
			 "RUN_ID",
			 "PMP_TS",
			 "EXECUTION_ID",
			 "CONVERSION_IND",
			 "INSERT_TS",
			 "MODIFIED_TS",
			 "BATCH_ID",
			 "RAI_TS",
			 "SUBSCR_ST",
			 "CONT_TREAT_CODE")
		 
		 	select "BAN",
			 "CONTR_TRANS_DT",
			 "ITEM_ID",
			 :CUSTOMER_EFF_DT,
			 "SUBSCR_NO",
			 "TRX_SEQ_NO",
			 "BSE_SOC_AMT",
			 "MIN_TIER_PRC",
			 "STNDLN_SELL_PRC",
			 "TRANS_PRC",
			 :ACTV_CD,
			 :ACTV_RSN_CD,
			 "BASE_OPT_SERV_IND",
			 "BSE_SOC",
			 "BYRS_RMRSE",
			 "CHRG_TY_CLASSIF",
			 "CONTR_DEALER_CODE",
			 "CONTR_END_DT",
			 "CONTR_ID",
			 "CONTR_STRT_DT",
			 "CONTR_TERM",
			 "CONTR_TIER",
			 "CONTR_TY",
			 "COST_CENTRE",
			 "DLR_CD",
			 "EI_GRP_SEQ_NO",
			 "EQP_SRC",
			 "EQP_TY",
			 "GL_ACCOUNT",
			 "GL_TAX_CD",
			(CASE WHEN :CONT_TREAT_CODE = 'SUS' THEN (ADD_DAYS(:CUSTOMER_EFF_DT,-1)) 
			ELSE null END) AS "ITEM_END_DT",
			 "ITEM_GRP_CD",
			 "ITEM_STRT_DT",
			 "ITEM_SUB_ID",
			 "JURISD_CD",
			 '99991231' ,
			 "PROMO_CD",
			 "PROV_AGR",
			 "PROV_CUST",
			 "SERV_TIER",
			 "SOC_LEV_CD",
			 "SUBS_AMT",
			 "SUBS_EFF_DT",
			 "SUBS_EXP_DT",
			 "TERM_M2M",
			 "REV_CD",
			 "BRND",
			 "KUNNR_SID",
			 "GL_PRICE_PLAN_GRP",
			 "ORIG_CONTR_STRT_DT",
			 "ORIG_CONTR_TERM",
			 "ORIG_STNDLN_SELL_PRC",
			 "ORIG_TRANS_PRC",
			 "VIR_INV_TS",
			 "DIST_CHANNEL",
			 "PRODUCT_TYPE",
			 "CUSTOMER_GROUP",
			 "MATERIAL_GROUP",
			 "REV_ACTG_DOC_NUM",
			 "BANNER",
			 "DEALER",
			 "REV_ACT_DOC_TY",
			 "ART_NUM",
			 "REFERENCE_ID",
			 "HEADER_ID",
			 "SRCDOC_ID",
			 "SRCDOC_ID_TERM",
			 "MOD_IND",
			 "TIME_IND",
			 "BILL_DATE",
			 "RAI_ITEM_ID",
			 "RUN_ID",
			 "PMP_TS",
			 "EXECUTION_ID",
			 "CONVERSION_IND",
			 :LV_CUR_UTC,
			 :LV_CUR_UTC,
			 "BATCH_ID",
			 null,
			 :SUBSCR_ST,
			 :CONT_TREAT_CODE
			 from #UPDATE_MOBL_POST_ORDER;
		 else
		 
		 	INSERT INTO #UPDATE_MOBL_POST_ORDER
	 		("BAN",
			 "CONTR_TRANS_DT",
			 "ITEM_ID",
			 "ITEM_TRANS_DT",
			 "SUBSCR_NO",
			 "TRX_SEQ_NO",
			 "BSE_SOC_AMT",
			 "MIN_TIER_PRC",
			 "STNDLN_SELL_PRC",
			 "TRANS_PRC",
			 "ACTV_CD",
			 "ACTV_RSN_CD",
			 "BASE_OPT_SERV_IND",
			 "BSE_SOC",
			 "BYRS_RMRSE",
			 "CHRG_TY_CLASSIF",
			 "CONTR_DEALER_CODE",
			 "CONTR_END_DT",
			 "CONTR_ID",
			 "CONTR_STRT_DT",
			 "CONTR_TERM",
			 "CONTR_TIER",
			 "CONTR_TY",
			 "COST_CENTRE",
			 "DLR_CD",
			 "EI_GRP_SEQ_NO",
			 "EQP_SRC",
			 "EQP_TY",
			 "GL_ACCOUNT",
			 "GL_TAX_CD",
			 "ITEM_END_DT",
			 "ITEM_GRP_CD",
			 "ITEM_STRT_DT",
			 "ITEM_SUB_ID",
			 "JURISD_CD",
			 "POB_END_DT",
			 "PROMO_CD",
			 "PROV_AGR",
			 "PROV_CUST",
			 "SERV_TIER",
			 "SOC_LEV_CD",
			 "SUBS_AMT",
			 "SUBS_EFF_DT",
			 "SUBS_EXP_DT",
			 "TERM_M2M",
			 "REV_CD",
			 "BRND",
			 "KUNNR_SID",
			 "GL_PRICE_PLAN_GRP",
			 "ORIG_CONTR_STRT_DT",
			 "ORIG_CONTR_TERM",
			 "ORIG_STNDLN_SELL_PRC",
			 "ORIG_TRANS_PRC",
			 "VIR_INV_TS",
			 "DIST_CHANNEL",
			 "PRODUCT_TYPE",
			 "CUSTOMER_GROUP",
			 "MATERIAL_GROUP",
			 "REV_ACTG_DOC_NUM",
			 "BANNER",
			 "DEALER",
			 "REV_ACT_DOC_TY",
			 "ART_NUM",
			 "REFERENCE_ID",
			 "HEADER_ID",
			 "SRCDOC_ID",
			 "SRCDOC_ID_TERM",
			 "MOD_IND",
			 "TIME_IND",
			 "BILL_DATE",
			 "RAI_ITEM_ID",
			 "RUN_ID",
			 "PMP_TS",
			 "EXECUTION_ID",
			 "CONVERSION_IND",
			 "INSERT_TS",
			 "MODIFIED_TS",
			 "BATCH_ID",
			 "RAI_TS",
			 "SUBSCR_ST",
			 "CONT_TREAT_CODE")		 
		 	 select "BAN",
			 "CONTR_TRANS_DT",
			 "ITEM_ID",
			 "ITEM_TRANS_DT",
			 "SUBSCR_NO",
			 "TRX_SEQ_NO",
			 "BSE_SOC_AMT",
			 "MIN_TIER_PRC",
			 "STNDLN_SELL_PRC",
			 "TRANS_PRC",
			 "ACTV_CD",
			 "ACTV_RSN_CD",
			 "BASE_OPT_SERV_IND",
			 "BSE_SOC",
			 "BYRS_RMRSE",
			 "CHRG_TY_CLASSIF",
			 "CONTR_DEALER_CODE",
			 "CONTR_END_DT",
			 "CONTR_ID",
			 "CONTR_STRT_DT",
			 "CONTR_TERM",
			 "CONTR_TIER",
			 "CONTR_TY",
			 "COST_CENTRE",
			 "DLR_CD",
			 "EI_GRP_SEQ_NO",
			 "EQP_SRC",
			 "EQP_TY",
			 "GL_ACCOUNT",
			 "GL_TAX_CD",
			 "ITEM_END_DT",
			 "ITEM_GRP_CD",
			 "ITEM_STRT_DT",
			 "ITEM_SUB_ID",
			 "JURISD_CD",
			 "POB_END_DT",
			 "PROMO_CD",
			 "PROV_AGR",
			 "PROV_CUST",
			 "SERV_TIER",
			 "SOC_LEV_CD",
			 "SUBS_AMT",
			 "SUBS_EFF_DT",
			 "SUBS_EXP_DT",
			 "TERM_M2M",
			 "REV_CD",
			 "BRND",
			 "KUNNR_SID",
			 "GL_PRICE_PLAN_GRP",
			 "ORIG_CONTR_STRT_DT",
			 "ORIG_CONTR_TERM",
			 "ORIG_STNDLN_SELL_PRC",
			 "ORIG_TRANS_PRC",
			 "VIR_INV_TS",
			 "DIST_CHANNEL",
			 "PRODUCT_TYPE",
			 "CUSTOMER_GROUP",
			 "MATERIAL_GROUP",
			 "REV_ACTG_DOC_NUM",
			 "BANNER",
			 "DEALER",
			 "REV_ACT_DOC_TY",
			 "ART_NUM",
			 "REFERENCE_ID",
			 "HEADER_ID",
			 "SRCDOC_ID",
			 "SRCDOC_ID_TERM",
			 "MOD_IND",
			 "TIME_IND",
			 "BILL_DATE",
			 "RAI_ITEM_ID",
			 "RUN_ID",
			 "PMP_TS",
			 "EXECUTION_ID",
			 "CONVERSION_IND",
			 "INSERT_TS",
			 "MODIFIED_TS",
			 "BATCH_ID",
			 "RAI_TS",
			 "SUBSCR_ST",
			 "CONT_TREAT_CODE"
			 from "NDB_MOBILITY"."IFRS_R1.MOBILITY.NDB_MOBILITY::MOBL_POST_ORDER" where 
			 SUBSCR_NO = :SUBSCR_NO and POB_END_DT = '99991231';
			 
			 select count(*) into RECORD_COUNT from #UPDATE_MOBL_POST_ORDER;
			 
			 if RECORD_COUNT > 0 then 
			 	
			 	-------------------------------------------------------------------------<
		 	    ----------------------------------------------------------------------------
			 	update "NDB_MOBILITY"."IFRS_R1.MOBILITY.NDB_MOBILITY::MOBL_POST_ORDER" o
			 	set o.POB_END_DT = ADD_DAYS(:CUSTOMER_EFF_DT,-1),
			 	o.MODIFIED_TS = :LV_CUR_UTC
				where 
				o.SUBSCR_NO = :SUBSCR_NO
				and o.POB_END_DT = '99991231';
			 	
		 	 	INSERT INTO "NDB_MOBILITY"."IFRS_R1.MOBILITY.NDB_MOBILITY::MOBL_POST_ORDER"
			 	("BAN",
				 "CONTR_TRANS_DT",
				 "ITEM_ID",
				 "ITEM_TRANS_DT",
				 "SUBSCR_NO",
				 "TRX_SEQ_NO",
				 "BSE_SOC_AMT",
				 "MIN_TIER_PRC",
				 "STNDLN_SELL_PRC",
				 "TRANS_PRC",
				 "ACTV_CD",
				 "ACTV_RSN_CD",
				 "BASE_OPT_SERV_IND",
				 "BSE_SOC",
				 "BYRS_RMRSE",
				 "CHRG_TY_CLASSIF",
				 "CONTR_DEALER_CODE",
				 "CONTR_END_DT",
				 "CONTR_ID",
				 "CONTR_STRT_DT",
				 "CONTR_TERM",
				 "CONTR_TIER",
				 "CONTR_TY",
				 "COST_CENTRE",
				 "DLR_CD",
				 "EI_GRP_SEQ_NO",
				 "EQP_SRC",
				 "EQP_TY",
				 "GL_ACCOUNT",
				 "GL_TAX_CD",
				 "ITEM_END_DT",
				 "ITEM_GRP_CD",
				 "ITEM_STRT_DT",
				 "ITEM_SUB_ID",
				 "JURISD_CD",
				 "POB_END_DT",
				 "PROMO_CD",
				 "PROV_AGR",
				 "PROV_CUST",
				 "SERV_TIER",
				 "SOC_LEV_CD",
				 "SUBS_AMT",
				 "SUBS_EFF_DT",
				 "SUBS_EXP_DT",
				 "TERM_M2M",
				 "REV_CD",
				 "BRND",
				 "KUNNR_SID",
				 "GL_PRICE_PLAN_GRP",
				 "ORIG_CONTR_STRT_DT",
				 "ORIG_CONTR_TERM",
				 "ORIG_STNDLN_SELL_PRC",
				 "ORIG_TRANS_PRC",
				 "VIR_INV_TS",
				 "DIST_CHANNEL",
				 "PRODUCT_TYPE",
				 "CUSTOMER_GROUP",
				 "MATERIAL_GROUP",
				 "REV_ACTG_DOC_NUM",
				 "BANNER",
				 "DEALER",
				 "REV_ACT_DOC_TY",
				 "ART_NUM",
				 "REFERENCE_ID",
				 "HEADER_ID",
				 "SRCDOC_ID",
				 "SRCDOC_ID_TERM",
				 "MOD_IND",
				 "TIME_IND",
				 "BILL_DATE",
				 "RAI_ITEM_ID",
				 "RUN_ID",
				 "PMP_TS",
				 "EXECUTION_ID",
				 "CONVERSION_IND",
				 "INSERT_TS",
				 "MODIFIED_TS",
				 "BATCH_ID",
				 "RAI_TS",
				 "SUBSCR_ST",
				 "CONT_TREAT_CODE")		 
			 	 select 
			 	 "BAN",
				 "CONTR_TRANS_DT",
				 "ITEM_ID",
				 :CUSTOMER_EFF_DT,
				 "SUBSCR_NO",
				 "TRX_SEQ_NO",
				 "BSE_SOC_AMT",
				 "MIN_TIER_PRC",
				 "STNDLN_SELL_PRC",
				 "TRANS_PRC",
				 :ACTV_CD,
				 :ACTV_RSN_CD,
				 "BASE_OPT_SERV_IND",
				 "BSE_SOC",
				 "BYRS_RMRSE",
				 "CHRG_TY_CLASSIF",
				 "CONTR_DEALER_CODE",
				 "CONTR_END_DT",
				 "CONTR_ID",
				 "CONTR_STRT_DT",
				 "CONTR_TERM",
				 "CONTR_TIER",
				 "CONTR_TY",
				 "COST_CENTRE",
				 "DLR_CD",
				 "EI_GRP_SEQ_NO",
				 "EQP_SRC",
				 "EQP_TY",
				 "GL_ACCOUNT",
				 "GL_TAX_CD",
				(CASE WHEN :CONT_TREAT_CODE = 'SUS' THEN (ADD_DAYS(:CUSTOMER_EFF_DT,-1)) 
			ELSE null END) AS "ITEM_END_DT",
				 "ITEM_GRP_CD",
				  "ITEM_STRT_DT",
				 "ITEM_SUB_ID",
				 "JURISD_CD",
				 '99991231' ,
				 "PROMO_CD",
				 "PROV_AGR",
				 "PROV_CUST",
				 "SERV_TIER",
				 "SOC_LEV_CD",
				 "SUBS_AMT",
				 "SUBS_EFF_DT",
				 "SUBS_EXP_DT",
				 "TERM_M2M",
				 "REV_CD",
				 "BRND",
				 "KUNNR_SID",
				 "GL_PRICE_PLAN_GRP",
				 "ORIG_CONTR_STRT_DT",
				 "ORIG_CONTR_TERM",
				 "ORIG_STNDLN_SELL_PRC",
				 "ORIG_TRANS_PRC",
				 "VIR_INV_TS",
				 "DIST_CHANNEL",
				 "PRODUCT_TYPE",
				 "CUSTOMER_GROUP",
				 "MATERIAL_GROUP",
				 "REV_ACTG_DOC_NUM",
				 "BANNER",
				 "DEALER",
				 "REV_ACT_DOC_TY",
				 "ART_NUM",
				 "REFERENCE_ID",
				 "HEADER_ID",
				 "SRCDOC_ID",
				 "SRCDOC_ID_TERM",
				 "MOD_IND",
				 "TIME_IND",
				 "BILL_DATE",
				 "RAI_ITEM_ID",
				 "RUN_ID",
				 "PMP_TS",
				 "EXECUTION_ID",
				 "CONVERSION_IND",
				 :LV_CUR_UTC,
				 :LV_CUR_UTC,
				 "BATCH_ID",
				 null,
				 :SUBSCR_ST,
				 :CONT_TREAT_CODE
				 from #UPDATE_MOBL_POST_ORDER;			 	
			 end if;
		 
	 	 end if;
		
END;
