PROCEDURE "COMMON"."IFRS_R1.COMMON_COMP.LAND_COMMON::SP_JOB_TABLE_COUNT"
(IN JOBNAME NVARCHAR(1000)
,OUT TAB_COUNT1 "NDB_COMMON"."IFRS_R1.COMMON_COMP.NDB_COMMON::COUNT_DISPLAY1")
	LANGUAGE SQLSCRIPT
	SQL SECURITY INVOKER 
	--DEFAULT SCHEMA <default_schema_name>
	--READS SQL DATA 
	AS
BEGIN

DECLARE LV_COUNT		INTEGER := 0;
DECLARE LV_VAR 			NVARCHAR(500);
DECLARE SQL_QUERY 		NVARCHAR(500);
DECLARE LV_CYCL_ID 		NVARCHAR(20);
DECLARE LV_PROCESS_ID 	NVARCHAR(20);
DECLARE LV_REC_COUNT 	NVARCHAR(20);

DECLARE CURSOR CUR_1 FOR
SELECT TABLE_NAME FROM "_SYS_BIC"."BC_EY89128/SOURCE_MAP_TABLE"
(PLACEHOLDER."$$JOBNAME$$" => :JOBNAME);

CREATE LOCAL TEMPORARY TABLE #TEMP_TABLE (ID1 INTEGER,CYCL_ID NVARCHAR(20),PROCESS_ID NVARCHAR(20),REC_COUNT NVARCHAR(20));
CREATE LOCAL TEMPORARY TABLE #TEMP_TABLE1 (TABLE_NAME NVARCHAR(500),CYCL_ID NVARCHAR(20),PROCESS_ID NVARCHAR(20), REC_COUNT NVARCHAR(20));



FOR REC as CUR_1 DO

LV_COUNT := LV_COUNT + 1;
/*******
SQL_QUERY := 'INSERT INTO   #TEMP_TABLE '
			 || ' VALUES (' ||LV_COUNT
			 ||',(SELECT COUNT(*) FROM '||REC.TABLE_NAME ||')'||')';
*****/

SQL_QUERY := 'INSERT INTO #TEMP_TABLE '  
             ||'(SELECT "BC_EY89128"."BC_EY89128::TEST".NEXTVAL, CYCL_ID,PROCESS_ID,COUNT(*) FROM '||REC.TABLE_NAME ||'GROUP BY CYCL_ID, PROCESS_ID'||')';

 
 --SQL_QUERY := 'INSERT INTO   #TEMP_TABLE ' || ' VALUES ( SELECT ' ||LV_COUNT||',  PROCESS_ID,CYCL_ID,COUNT(*) FROM '||REC.TABLE_NAME ||' GROUP BY PROCESS_ID , CYCL_ID)';          

              			 	
--select SQL_QUERY		 	  
EXECUTE IMMEDIATE SQL_QUERY;

SELECT CYCL_ID,PROCESS_ID, REC_COUNT INTO LV_CYCL_ID, LV_PROCESS_ID,LV_REC_COUNT
 FROM #TEMP_TABLE WHERE ID1 = LV_COUNT;

INSERT INTO #TEMP_TABLE1 VALUES(REC.TABLE_NAME , LV_CYCL_ID, LV_PROCESS_ID,LV_REC_COUNT
--(SELECT CYCL_ID,PROCESS_ID, REC_COUNT FROM #TEMP_TABLE WHERE ID1 = LV_COUNT)
);


END FOR;  

TAB_COUNT1 = SELECT * FROM #TEMP_TABLE1;
DROP TABLE #TEMP_TABLE;
DROP TABLE #TEMP_TABLE1;
END;